# 动态标签业务规则说明

## 一、业务规则

### 1. 固定标签字段
- **QUALITY_DATA_SHARE（优质数据共享客户）** 等固定标签字段：
  - ✅ 继续使用固定字段存储和查询
  - ✅ 不写入JSON字段
  - ✅ 查询时直接使用固定字段，如 `WHERE QUALITY_DATA_SHARE = '1'`

### 2. 动态标签字段
- **其他后续动态增加的标签列**：
  - ✅ 以JSON格式存放在 `DYNAMIC_TAGS` 字段中
  - ✅ 使用**中文键值对**格式，例如：
    ```json
    {
      "优质客户": "是",
      "重点区域": "重点区域A",
      "特殊渠道": "是"
    }
    ```
  - ✅ 查询时使用MySQL JSON函数，如 `JSON_EXTRACT(DYNAMIC_TAGS, '$.优质客户') = '是'`

## 二、实现细节

### 1. 数据导入
- Excel导入时，`QUALITY_DATA_SHARE` 字段直接写入固定字段
- Excel导入时，其他动态标签通过 `DYNAMIC_TAGS` 列以JSON格式导入
- `enrichDynamicTags` 方法只处理Excel中直接提供的 `DYNAMIC_TAGS` 字段，确保格式正确

### 2. 数据查询
- 固定标签字段（如 `QUALITY_DATA_SHARE`）：直接使用固定字段查询
- 动态标签：使用MySQL JSON函数查询，如：
  ```sql
  JSON_EXTRACT(DYNAMIC_TAGS, '$.优质客户') = '是'
  ```

### 3. 代码使用
- 固定标签字段：直接使用PO类的getter方法，如 `customer.getQualityDataShare()`
- 动态标签：使用 `DynamicTagHelper.getDynamicTagValue(customer, "优质客户")`

## 三、示例

### 示例1：固定标签字段查询
```sql
-- 查询优质数据共享客户
SELECT * FROM customer_filter 
WHERE QUALITY_DATA_SHARE = '1';
```

### 示例2：动态标签查询
```sql
-- 查询优质客户
SELECT * FROM customer_filter 
WHERE JSON_EXTRACT(DYNAMIC_TAGS, '$.优质客户') = '是';
```

### 示例3：Java代码读取
```java
// 读取固定标签字段
String qualityDataShare = customer.getQualityDataShare();

// 读取动态标签
String premiumCustomer = DynamicTagHelper.getDynamicTagValue(customer, "优质客户");
```

## 四、注意事项

1. **JSON键名必须是中文**：动态标签的键名应使用中文，如 `"优质客户"` 而不是 `"premium_customer"`
2. **固定字段不写入JSON**：`QUALITY_DATA_SHARE` 等固定字段不会写入 `DYNAMIC_TAGS` JSON字段
3. **向后兼容**：现有使用 `QUALITY_DATA_SHARE` 的代码无需修改，继续正常工作

---

**最后更新**: 2025-12-20

