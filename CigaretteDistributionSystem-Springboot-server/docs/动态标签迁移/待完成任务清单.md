# 待完成任务清单

## 一、更新日期
2025-12-20

## 二、待完成任务

### 1. 迁移脚本更新 ✅
- **问题**: `migrate-existing-tags-to-json.sql` 脚本将QUALITY_DATA_SHARE迁移到JSON字段，但根据新的业务规则，QUALITY_DATA_SHARE不应该写入JSON字段
- **已完成**:
  - ✅ 更新迁移脚本注释，说明该脚本已不再需要
  - ✅ 创建清理脚本 `remove-quality-data-share-from-json.sql`，用于清理错误写入的数据
- **待执行**:
  - [ ] 检查数据库中是否有通过该脚本迁移的数据需要清理
  - [ ] 如果有，执行清理脚本 `remove-quality-data-share-from-json.sql`

### 2. 功能验证 🔍
- **任务**:
  - [ ] 运行完整的区域客户统计测试，验证标签过滤功能正常
  - [ ] 验证分配写回功能正常（特别是价格段自选投放功能）
  - [ ] 性能测试（JSON字段查询性能，与固定字段查询对比）
  - [ ] 验证所有使用标签的业务功能正常工作

### 3. 文档完善 📚
- **任务**:
  - [ ] 更新API文档，说明固定标签字段和动态标签字段的使用方法
  - [ ] 添加使用示例和最佳实践
  - [ ] 更新开发指南，说明如何添加新的动态标签
  - [ ] 创建迁移指南，说明从固定字段迁移到动态标签的步骤（如果需要）

### 4. 监控和优化 📊
- **任务**:
  - [ ] 监控JSON字段查询性能
  - [ ] 为常用动态标签创建虚拟列索引（如需要）
  - [ ] 优化查询性能（如果发现性能问题）
  - [ ] 添加性能监控和告警

### 5. 数据清理（可选）🧹
- **任务**:
  - [ ] 检查数据库中是否有通过旧迁移脚本错误写入的QUALITY_DATA_SHARE JSON数据
  - [ ] 如果有，执行清理脚本 `remove-quality-data-share-from-json.sql`
  - [ ] 验证数据一致性

## 三、优先级说明

### 高优先级 🔴
1. **数据清理检查**：检查并清理错误写入的JSON数据
2. **功能验证**：确保所有业务功能正常工作

### 中优先级 🟡
3. **文档完善**：帮助开发人员正确使用新功能

### 低优先级 🟢
4. **监控和优化**：持续改进系统性能

## 四、注意事项

1. **业务规则**：
   - QUALITY_DATA_SHARE等固定标签字段继续使用固定字段，不写入JSON
   - 其他动态标签使用JSON格式，中文键值对

2. **向后兼容**：
   - 现有使用固定标签字段的代码无需修改
   - 保持对固定字段的读取支持

3. **性能考虑**：
   - JSON字段查询可能比固定字段查询稍慢
   - 建议为常用标签创建虚拟列索引

## 五、相关脚本

### 迁移脚本（已废弃）
- `migrate-existing-tags-to-json.sql`: 已更新注释，说明不再需要

### 清理脚本（新增）
- `remove-quality-data-share-from-json.sql`: 用于清理错误写入的quality_data_share JSON数据

---

**最后更新**: 2025-12-20
