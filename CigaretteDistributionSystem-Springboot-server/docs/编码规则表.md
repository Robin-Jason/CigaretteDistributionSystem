# **卷烟预测投放编码规则**

## **第一部分：卷烟单卷烟单区域投放编码规则**

### **1. 编码化表达总体结构**

每条卷烟每个区域生成一个编码记录，格式如下：

```
<投放类型><扩展投放类型+标签>(<主扩展前缀>主扩展编号 +<子扩展前缀>子扩展编号>)(<投放量编码>)
```

- **投放类型**：算法预测的投放策略类型
- **扩展投放类型+标签**：扩展维度编码 + 标签（最多 1 个）
- **主扩展**：任意维度，括号内写主扩展编号
- **子扩展**：前面加 +，统一使用前缀 + 编号
- **投放量编码**：该区域的 30 个档位投放量，连续相同档位可聚合
- 每条记录对应 **单条卷烟 + 单个区域**

------



### **2. 投放类型编码**

| **编码** | **含义**           |
| -------- | ------------------ |
| A        | 按档位投放         |
| B        | 按档位扩展投放     |
| C        | 按价位段自选投放   |
| D        | 按需投放（未实现） |
| E        | 选点投放（未实现） |

------



### **3. 扩展投放类型编码**

| **扩展类型** | **编码** |
| ------------ | -------- |
| 区县         | 1        |
| 市场类型     | 2        |
| 城乡分类代码 | 3        |
| 业态         | 4        |
| 市场部       | 5        |
| 商圈类型     | 6        |
| 信用等级     | 7        |
| 诚信自律小组 | 8        |

- **组合规则**：
  - 单扩展 → 直接数字
  - 双扩展 → 主扩展-子扩展
  - 标签 → 写在扩展投放类型后，用 + 连接，如 +a

------



### **4. 区域前缀规范**

| **维度**     | **子扩展前缀** |
| ------------ | -------------- |
| 区县         | Q              |
| 市场类型     | M              |
| 业态         | Y              |
| 城乡分类代码 | F              |
| 商圈类型     | S              |
| 市场部       | B              |
| 信用等级     | X              |
| 诚信自律小组 | Z              |

------


### **4.1 区域编号映射（按客户数降序）**

> 数据来源：`base_customer_info`，统计时间以 2025-11-28 日数据库为准；若后续客户数发生变化，可重新按下述 SQL 语句生成最新编号。**缺失值视为数据缺失，不参与编号。**

**区县（Q）**

| 编号 | 区域 | 客户数 |
| --- | --- | --- |
| Q1 | 城区烟草专卖局(营销部) | 4,235 |
| Q2 | 丹江口市烟草专卖局(营销部) | 2,195 |
| Q3 | 房县烟草专卖局(营销部) | 1,945 |
| Q4 | 郧阳区烟草专卖局(营销部) | 1,794 |
| Q5 | 竹山县烟草专卖局(营销部) | 1,761 |
| Q6 | 郧西县烟草专卖局(营销部) | 1,745 |
| Q7 | 竹溪县烟草专卖局(营销部) | 1,345 |

**市场类型（M）**

| 编号 | 类型 | 客户数 |
| --- | --- | --- |
| M1 | 城网 | 11,162 |
| M2 | 农网 | 3,857 |

**业态（Y）**

| 编号 | 业态 | 客户数 |
| --- | --- | --- |
| Y1 | 便利店 | 13,002 |
| Y2 | 其他 | 935 |
| Y3 | 烟草专业店 | 726 |
| Y4 | 娱乐服务类 | 280 |
| Y5 | 超市 | 70 |
| Y6 | 商场 | 6 |

**城乡分类代码（F）**

| 编号 | 分类 | 客户数 |
| --- | --- | --- |
| F1 | 主城区 | 5,942 |
| F2 | 村庄 | 3,037 |
| F3 | 镇中心区 | 2,827 |
| F4 | 镇乡结合区 | 2,010 |
| F5 | 乡中心区 | 820 |
| F6 | 特殊区域 | 264 |
| F7 | 城乡结合区 | 119 |

**商圈类型（S）**

| 编号 | 商圈 | 客户数 |
| --- | --- | --- |
| S1 | 居民区 | 8,352 |
| S2 | 集贸区 | 5,785 |
| S3 | 工业区 | 278 |
| S4 | 商业娱乐区 | 258 |
| S5 | 办公区 | 116 |
| S6 | 旅游景区 | 108 |
| S7 | 交通枢纽区 | 77 |
| S8 | 院校学区 | 34 |
| S9 | 其他 | 11 |

**市场部（B）**

| 编号 | 市场部 | 客户数 |
| --- | --- | --- |
| B1 | 茅箭市场部 | 1,431 |
| B2 | 白浪市场部 | 1,405 |
| B3 | 张湾市场部 | 1,399 |
| B4 | 丹江口城区市场部 | 953 |
| B5 | 房县城关市场部 | 916 |
| B6 | 城关市场部 | 882 |
| B7 | 竹山城关市场部 | 664 |
| B8 | 武当山市场部 | 658 |
| B9 | 郧阳城关市场部 | 653 |
| B10 | 宝丰市场部 | 554 |
| B11 | 竹溪城关市场部 | 485 |
| B12 | 羊尾市场部 | 481 |
| B13 | 柳陂市场部 | 476 |
| B14 | 南化市场部 | 448 |
| B15 | 店子市场部 | 382 |
| B16 | 竹坪市场部 | 321 |
| B17 | 浪河市场部 | 309 |
| B18 | 蒋家堰市场部 | 301 |
| B19 | 化龙市场部 | 298 |
| B20 | 水坪市场部 | 291 |
| B21 | 习家店市场部 | 275 |
| B22 | 泉溪市场部 | 268 |
| B23 | 大木市场部 | 263 |
| B24 | 青峰市场部 | 249 |
| B25 | 官渡市场部 | 222 |
| B26 | 门古市场部 | 219 |
| B27 | 鲍峡市场部 | 217 |

**信用等级（X）**

| 编号 | 等级 | 客户数 |
| --- | --- | --- |
| X1 | AA | 14,527 |
| X2 | C | 216 |
| X3 | D | 182 |
| X4 | A | 33 |
| X5 | AAA | 28 |
| X6 | B | 9 |

**诚信自律小组（Z）**

- 共有数百个小组，客户数跨度较大。考虑到数量庞大，该维度的编号通过以下 SQL 自动生成并写入缓存表/配置文件后再引用：

```
SELECT GROUP_NAME,
       ROW_NUMBER() OVER (ORDER BY COUNT(*) DESC) AS rank_no,
       COUNT(*) AS customer_cnt
FROM base_customer_info
GROUP BY GROUP_NAME
ORDER BY customer_cnt DESC;
```

- 编码规则：按查询结果的 `rank_no` 依次赋值为 Z1、Z2、...。如需固定编号，可将结果导出为 `docs/group-name-codes.csv` 并在系统初始化时加载。
- 系统在每次 `base_customer_info` 更新后，会自动执行上述 SQL，将结果写入数据库表 `integrity_group_code_mapping`（先清空再重建），保证编码与客户数据同步。

------

### **5. 区域编码规则**

- **格式**：



```
(<主扩展前缀>主扩展编号 +<子扩展前缀>子扩展编号>)
```

- **说明**：
  1. 主扩展可以为任意维度，括号内只包含单个编号
  2. 子扩展统一在前面加 +，使用前缀 + 编号
  3. 无子扩展时，只写主扩展
- **示例**：



```
(Q2 +Y2)   # 主扩展区县2 + 子扩展业态2
(Y1 +Q3)   # 主扩展业态1 + 子扩展区县3
(M1)       # 主扩展市场类型1，无子扩展
```

------





### **6. 投放量编码规则**

- **格式**：



```
(<档位跨度×投放量 + ...>)
```

- **说明**：

  1. 针对该区域的 **30 个档位投放量**
  2. 连续档位相同投放量可聚合
  3. **必须覆盖 30 个档位**，即使部分档位投放量为 0，也必须写入
  4. 各组之间用 + 连接

  

- **示例**：



```
(5×9+5×8+10×7+5×6+5×0)
```

------





### **7. 完整示例（单卷烟单区域）**

- 投放类型：B（按档位扩展投放）
- 扩展投放类型：区县+业态 → B1-4
- 标签：优质数据共享客户 → +a
- 主扩展：区县 → 2
- 子扩展：业态 → 2
- 投放量：5×9 + 5×8 + 10×7 + 5×6 + 5×0

**编码化表达**：

```
B1-4+a(Q2 +Y2)(5×9+5×8+10×7+5×6+5×0)
```

------





## **第二部分：卷烟单卷烟多区域投放聚合编码规则**

### **1. 聚合前提**

1. 每条卷烟在不同区域的投放量矩阵为 30 个档位
2. **仅当投放量完全一致**时，才考虑聚合
3. **聚合分两层**：
   - **第一层**：主扩展聚合 → 条件：投放量一致且子扩展一致
   - **第二层**：子扩展聚合 → 条件：投放量一致且第一层聚合后主扩展一致
4. 不满足聚合条件的记录 → 保持独立编码

------



### **2. 聚合编码结构**

```
<投放类型><扩展投放类型+标签>(<聚合主扩展+编号> +<聚合子扩展+编号>)(<聚合投放量>)
```

- **投放类型 + 扩展投放类型 + 标签**：与单区域一致
- **聚合主/子扩展**：
  - **第一层**：投放量一致且子扩展一致 → 合并主扩展编号，用 + 连接
  - **第二层**：投放量一致且主扩展一致 → 合并子扩展编号，用 + 连接
- **投放量编码必须覆盖 30 档位**，即使部分为 0

------



### **3. 示例**

| **区域** | **投放量**             |
| -------- | ---------------------- |
| Q2 +Y2   | (5×9+5×8+10×7+5×6+5×0) |
| Q4 +Y2   | (5×9+5×8+10×7+5×6+5×0) |
| Q5 +Y2   | (5×9+5×8+10×7+5×6+5×0) |
| Q3 +Y4   | (5×9+5×8+10×7+5×6+5×0) |
| Q5 +Y5   | (4×8+6×7+10×6)         |



#### **第一层聚合（主扩展聚合）**

- 子扩展 Y2 相同 → 合并主扩展 Q2、Q4、Q5 → (Q2+4+5 +Y2)
- 子扩展不同 → 保留完整编码 (Q3 +Y4)
- 投放量不同 → 保留 (Q5 +Y5)

**结果**：

```
(Q2+4+5 +Y2)(5×9+5×8+10×7+5×6+5×0)
(Q3 +Y4)(5×9+5×8+10×7+5×6+5×0)
(Q5 +Y5)(4×8+6×7+10×6)
```



#### **第二层聚合（子扩展聚合）**

- 对第一层结果检查：
  - 主扩展一致 → 合并子扩展
  - 本例中子扩展已经统一或不同 → 不再聚合

**最终聚合编码**：

```
B1-4+a(Q2+4+5 +Y2)(5×9+5×8+10×7+5×6+5×0)
B1-4+a(Q3 +Y4)(5×9+5×8+10×7+5×6+5×0)
B1-4+a(Q5 +Y5)(4×8+6×7+10×6)
```

------



✅ **规则总结 



1. 聚合分两层：根据投放量是否一致，先合并主扩展，再合并子扩展
2. 聚合前必须投放量完全一致
3. 子/主扩展不一致 → 保持独立编码
4. 每条卷烟只聚合自身的区域
5. **子扩展前缀前面必须加 +**
6. 投放量编码跨度必须覆盖 30 个档位，包含投放量 0
7. 单区域编码写入数据库，前端根据需求展示